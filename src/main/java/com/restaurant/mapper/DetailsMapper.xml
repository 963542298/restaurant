<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.restaurant.mapper.DetailsMapper" >


    <resultMap id="queryDetailsByOrdersIdMap" type="Details">
        <id property="detailsid" column="detailsid"/>
        <result property="num" column="num"/>
        <association property="food" javaType="Food">
            <id property="foodid" column="foodid"/>
            <result column="foodname" property="foodname"/>
            <result property="foodpath" column="foodpath"/>
            <result property="foodstate" column="foodstate"/>
            <association property="type" javaType="Type">
                <id property="typeid" column="typeid"/>
                <result property="typename" column="typename"/>
            </association>
        </association>
    </resultMap>

    <insert id="addDetails">
        insert into details(orderid,foodid,num) values
        <foreach collection="foodUtilList" item="foodUtil" open="(" separator="),(" close=")">
            #{orderid},#{foodUtil.foodid},#{foodUtil.num}
        </foreach>

    </insert>

    <select id="queryDetailsByOrdersId" resultMap="queryDetailsByOrdersIdMap">
        select detailsid,num,
        f.foodid,foodname,foodpath,foodstate,
        t.typeid,typename
        from details d
        left join food f
        on d.foodid = f.foodid
        left join type t
        on t.typeid = f.typeid
        where d.orderid = #{value}
    </select>

</mapper>